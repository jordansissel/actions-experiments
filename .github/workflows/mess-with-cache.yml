name: Mess with cache

on:
  workflow_dispatch:

jobs:
  do-it:
    runs-on: ubuntu-latest

    steps:
      - name: Hoodwink
        run: |
          ln -s / /whoa

      - name: Cache
        id: cache-it
        uses: actions/cache@v4
        with:
          path: /whoa/usr/bin/hello.sh
          key: ${{ runner.os }}-ruby-build-${{ inputs.ruby_build_version }}

      - name: Generate
        if: steps.cache-it.outputs.cache-hit != "true"
        run: |
          rm -f /whoa
          sudo mkdir -p /whoa/usr/bin/hello.sh
          echo "echo 'Hello world'" > /whoa/usr/bin/hello.sh
          sudo rsync -av /whoa/ /

      - name: Try it.
        run: |
          ls -ld /whoa
          ls -ld /whoa/usr/bin/hello.sh
          ls -ld /usr/bin/hello.sh

          sh /usr/bin/hello.sh
